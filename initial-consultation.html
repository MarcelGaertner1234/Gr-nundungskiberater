<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="consultation.pageTitle">Kostenloses Erstgespr√§ch - KI Konzept Builder</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="notion-design-system.css">
    <link rel="stylesheet" href="landing-page-design-system.css">
    <link rel="stylesheet" href="loading-states.css">
    <link rel="stylesheet" href="calendar-styles.css">
    <link rel="stylesheet" href="modal-styles.css">
    <link rel="stylesheet" href="dark-mode-consistency.css">
    <link rel="stylesheet" href="theme-toggle-redesign.css">
    
    <!-- üé® DESIGN CONSISTENCY: Utility Classes f√ºr Inline-Style Cleanup -->
    <link rel="stylesheet" href="css/utilities.css">
    
    <style>
        body {
            background: linear-gradient(to bottom, #f6f5f4 0%, #fff 100%);
            min-height: 100vh;
            padding-top: 80px;
            transition: background 0.3s ease;
        }
        
        /* Dark Mode Body */
        [data-theme="dark"] body {
            background: linear-gradient(to bottom, #0a0a0a 0%, #121212 100%);
        }
        
        .consultation-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .consultation-header {
            text-align: center;
            margin-bottom: 60px;
        }
        
        .consultation-header h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1f2937;
            background: linear-gradient(90deg, #097fe8, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        [data-theme="dark"] .consultation-header h1 {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .consultation-header p {
            font-size: 20px;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        [data-theme="dark"] .consultation-header p {
            color: #9ca3af;
        }
        
        .consultation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        /* Idea Form Section */
        .idea-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .idea-section {
            background: #1e1e1e;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .idea-section h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        [data-theme="dark"] .idea-section h2 {
            color: #f3f4f6;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            font-size: 16px;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 8px;
            display: block;
        }
        
        [data-theme="dark"] .form-label {
            color: #e5e7eb;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            font-family: inherit;
            background: white;
            color: #1f2937;
        }
        
        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-textarea {
            background: #2d2d2d;
            border-color: #374151;
            color: #f3f4f6;
        }
        
        [data-theme="dark"] .form-input::placeholder,
        [data-theme="dark"] .form-textarea::placeholder {
            color: #6b7280;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #097fe8;
            box-shadow: 0 0 0 3px rgba(9, 127, 232, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .form-helper {
            font-size: 14px;
            color: #6b7280;
            margin-top: 6px;
        }
        
        [data-theme="dark"] .form-helper {
            color: #9ca3af;
        }
        
        /* Calendar Section */
        .calendar-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .calendar-section {
            background: #1e1e1e;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .calendar-section h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        [data-theme="dark"] .calendar-section h2 {
            color: #f3f4f6;
        }
        
        .time-slot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 24px;
        }
        
        .time-slot {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            color: #1f2937;
        }
        
        [data-theme="dark"] .time-slot {
            background: #2d2d2d;
            border-color: #374151;
            color: #f3f4f6;
        }
        
        .time-slot:hover {
            border-color: #097fe8;
            background: #f0f7ff;
        }
        
        [data-theme="dark"] .time-slot:hover {
            border-color: #4f46e5;
            background: rgba(79, 70, 229, 0.1);
        }
        
        .time-slot.selected {
            border-color: #097fe8;
            background: #097fe8;
            color: white;
        }
        
        .time-slot.unavailable {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        [data-theme="dark"] .time-slot.unavailable {
            background: #1a1a1a;
            color: #4b5563;
        }
        
        /* Benefits Section */
        .benefits-section {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .benefits-section {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }
        
        .benefit-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(14, 165, 233, 0.2);
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .benefit-card {
            background: #1e1e1e;
            border: 1px solid rgba(79, 70, 229, 0.3);
        }
        
        .benefit-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .benefit-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }
        
        [data-theme="dark"] .benefit-title {
            color: #f3f4f6;
        }
        
        .benefit-description {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
        }
        
        [data-theme="dark"] .benefit-description {
            color: #9ca3af;
        }
        
        /* Submit Section */
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }
        
        .submit-btn {
            background: linear-gradient(90deg, #097fe8, #8b5cf6);
            color: white;
            padding: 16px 48px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(9, 127, 232, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Success Message */
        .success-message {
            display: none;
            background: #f0fdf4;
            border: 1px solid #10b981;
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .success-message {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
        }
        
        .success-message h3 {
            font-size: 20px;
            font-weight: 600;
            color: #065f46;
            margin-bottom: 8px;
        }
        
        [data-theme="dark"] .success-message h3 {
            color: #10b981;
        }
        
        .success-message p {
            color: #047857;
            margin-bottom: 16px;
        }
        
        [data-theme="dark"] .success-message p {
            color: #34d399;
        }
        
        /* Calendar Widget */
        .calendar-widget {
            background: #f9fafb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .calendar-widget {
            background: #2d2d2d;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-month {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        [data-theme="dark"] .calendar-month {
            color: #f3f4f6;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
        }
        
        .calendar-nav button {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #1f2937;
        }
        
        [data-theme="dark"] .calendar-nav button {
            background: #1e1e1e;
            border-color: #374151;
            color: #f3f4f6;
        }
        
        .calendar-nav button:hover {
            background: #f3f4f6;
        }
        
        [data-theme="dark"] .calendar-nav button:hover {
            background: #374151;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-days:first-of-type {
            margin-bottom: 12px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            padding: 8px 0;
        }
        
        [data-theme="dark"] .calendar-day-header {
            color: #9ca3af;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            color: #1f2937;
        }
        
        [data-theme="dark"] .calendar-day {
            color: #f3f4f6;
        }
        
        .calendar-day.available {
            background: white;
            border: 1px solid #e5e7eb;
        }
        
        [data-theme="dark"] .calendar-day.available {
            background: #1e1e1e;
            border-color: #374151;
        }
        
        .calendar-day.available:hover {
            background: #f0f7ff;
            border-color: #097fe8;
        }
        
        [data-theme="dark"] .calendar-day.available:hover {
            background: rgba(79, 70, 229, 0.1);
            border-color: #4f46e5;
        }
        
        .calendar-day.selected {
            background: #097fe8;
            color: white;
            border-color: #097fe8;
        }
        
        .calendar-day.unavailable {
            color: #d1d5db;
            cursor: not-allowed;
        }
        
        [data-theme="dark"] .calendar-day.unavailable {
            color: #4b5563;
        }
        
        .calendar-day.today {
            border: 2px solid #097fe8;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .consultation-content {
                grid-template-columns: 1fr;
            }
            
            .consultation-header h1 {
                font-size: 36px;
            }
            
            .benefits-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header header-glass fixed w-full z-1000">
        <div class="container-1200">
            <div class="header-content flex justify-between items-center h-70">
                <div class="header-logo">
                    <a href="landing-page.html" class="logo flex items-center text-dark font-semibold text-lg no-underline gap-10">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="flex-shrink-0">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z" fill="url(#logo-gradient)"/>
                            <defs>
                                <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#097fe8;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </svg>
                        KI Konzept Builder
                    </a>
                </div>
                <div class="header-nav flex items-center gap-24">
                    <div id="sessionInfo" class="hidden items-center mr-16 gap-16">
                        <span id="userNameDisplay" class="text-medium text-sm"></span>
                    </div>
                    <a href="dashboard.html" class="nav-link text-medium no-underline font-medium rounded p-16" data-i18n="nav.dashboard">Dashboard</a>
                    <a href="login.html" id="loginBtn" class="btn-gradient-primary inline-block" data-i18n="nav.login">Anmelden</a>
                    <a href="#" id="logoutBtn" onclick="logout()" class="hidden text-danger no-underline font-medium p-16" data-i18n="nav.logout">Abmelden</a>
                </div>
            </div>
        </div>
    </header>

    <div class="consultation-container">
        <!-- Header Section -->
        <div class="consultation-header">
            <h1 data-i18n="consultation.header.title">Kostenloses Erstgespr√§ch buchen</h1>
            <p data-i18n="consultation.header.subtitle">Erz√§hle uns von deiner Gesch√§ftsidee und sichere dir eine kostenlose 30-min√ºtige Beratung mit unseren Gr√ºndungsexperten</p>
        </div>
        
        <!-- Benefits Section -->
        <div class="benefits-section">
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">üéØ</div>
                    <div class="benefit-title" data-i18n="consultation.benefits.tailored.title">Ma√ügeschneiderte Beratung</div>
                    <div class="benefit-description" data-i18n="consultation.benefits.tailored.description">Wir bereiten uns auf deine Idee vor und geben dir konkrete Tipps</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">üí∞</div>
                    <div class="benefit-title" data-i18n="consultation.benefits.free.title">100% Kostenlos</div>
                    <div class="benefit-description" data-i18n="consultation.benefits.free.description">Keine versteckten Kosten, keine Verpflichtungen</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">üöÄ</div>
                    <div class="benefit-title" data-i18n="consultation.benefits.quickstart.title">Schnellstart-Plan</div>
                    <div class="benefit-description" data-i18n="consultation.benefits.quickstart.description">Erhalte einen konkreten Fahrplan f√ºr deine Gr√ºndung</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">üèÜ</div>
                    <div class="benefit-title" data-i18n="consultation.benefits.experts.title">Erfahrene Experten</div>
                    <div class="benefit-description" data-i18n="consultation.benefits.experts.description">Unsere Berater haben √ºber 100+ Gr√ºndungen begleitet</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="consultation-content">
            <!-- Idea Form Section -->
            <div class="idea-section">
                <h2 data-i18n="consultation.form.title">üí° Deine Gesch√§ftsidee</h2>
                
                <form id="consultationForm">
                    <div class="form-group">
                        <label class="form-label" for="userName" data-i18n="consultation.form.name.label">Dein Name *</label>
                        <input type="text" id="userName" class="form-input" required placeholder="Max Mustermann" data-i18n-placeholder="consultation.form.name.placeholder">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userEmail" data-i18n="consultation.form.email.label">E-Mail-Adresse *</label>
                        <input type="email" id="userEmail" class="form-input" required placeholder="max@beispiel.de" data-i18n-placeholder="consultation.form.email.placeholder">
                        <p class="form-helper" data-i18n="consultation.form.email.helper">Wir senden dir hier die Terminbest√§tigung</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userPhone" data-i18n="consultation.form.phone.label">Telefonnummer (optional)</label>
                        <input type="tel" id="userPhone" class="form-input" placeholder="+49 123 456789" data-i18n-placeholder="consultation.form.phone.placeholder">
                        <p class="form-helper" data-i18n="consultation.form.phone.helper">F√ºr kurzfristige Termin√§nderungen</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="businessIdea" data-i18n="consultation.form.idea.label">Beschreibe deine Gesch√§ftsidee *</label>
                        <textarea id="businessIdea" class="form-textarea" required placeholder="Ich m√∂chte ein Online-Marktplatz f√ºr..." data-i18n-placeholder="consultation.form.idea.placeholder"></textarea>
                        <p class="form-helper" data-i18n="consultation.form.idea.helper">Je detaillierter, desto besser k√∂nnen wir uns vorbereiten</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="currentStage" data-i18n="consultation.form.stage.label">In welcher Phase befindest du dich? *</label>
                        <select id="currentStage" class="form-input" required>
                            <option value="" data-i18n="consultation.form.stage.placeholder">Bitte w√§hlen...</option>
                            <option value="idea" data-i18n="consultation.form.stage.idea">Nur eine Idee</option>
                            <option value="research" data-i18n="consultation.form.stage.research">Marktforschung</option>
                            <option value="prototype" data-i18n="consultation.form.stage.prototype">Prototyp/MVP vorhanden</option>
                            <option value="early_customers" data-i18n="consultation.form.stage.earlyCustomers">Erste Kunden</option>
                            <option value="scaling" data-i18n="consultation.form.stage.scaling">Skalierung geplant</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="mainChallenge" data-i18n="consultation.form.challenge.label">Was ist deine gr√∂√üte Herausforderung?</label>
                        <textarea id="mainChallenge" class="form-textarea" placeholder="Ich brauche Hilfe bei der Finanzierung..." data-i18n-placeholder="consultation.form.challenge.placeholder"></textarea>
                    </div>
                </form>
            </div>
            
            <!-- Calendar Section -->
            <div class="calendar-section">
                <h2 data-i18n="consultation.calendar.title">üìÖ W√§hle deinen Wunschtermin</h2>
                
                <!-- Calendar Widget -->
                <div class="calendar-widget">
                    <div class="calendar-header">
                        <span class="calendar-month" id="calendarMonth">Januar 2025</span>
                        <div class="calendar-nav">
                            <button onclick="previousMonth()">‚Üê</button>
                            <button onclick="nextMonth()">‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="calendar-days">
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.mon">Mo</div>
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.tue">Di</div>
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.wed">Mi</div>
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.thu">Do</div>
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.fri">Fr</div>
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.sat">Sa</div>
                        <div class="calendar-day-header" data-i18n="consultation.calendar.weekdays.sun">So</div>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                        <!-- Calendar days will be populated here -->
                    </div>
                </div>
                
                <!-- Time Slots -->
                            <div id="timeSlotSection" class="hidden">
                <h3 class="text-lg font-semibold mb-16" data-i18n="consultation.calendar.availableTimes">Verf√ºgbare Zeiten</h3>
                    <div class="time-slot-grid" id="timeSlotGrid">
                        <!-- Time slots will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Selected Time Display -->
                                <div id="selectedTimeDisplay" class="hidden mt-24 p-16 bg-primary-light rounded">
                    <p class="font-medium text-dark">
                        <span class="text-primary">‚úì</span> <span data-i18n="consultation.calendar.selectedAppointment">Ausgew√§hlter Termin:</span>
                        <span id="selectedDateTime" class="font-semibold"></span>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Submit Section -->
        <div class="submit-section">
            <button class="submit-btn" id="submitBtn" onclick="submitConsultation()" disabled>
                <span data-i18n="consultation.submit.button">üöÄ Kostenloses Erstgespr√§ch buchen</span>
            </button>
            
            <div class="success-message" id="successMessage">
                <h3 data-i18n="consultation.success.title">üéâ Termin erfolgreich gebucht!</h3>
                <p data-i18n="consultation.success.message">Wir haben dir eine Best√§tigungs-E-Mail gesendet. Wir freuen uns auf unser Gespr√§ch!</p>
                <a href="dashboard.html" class="btn btn-primary" data-i18n="consultation.success.button">Zum Dashboard</a>
            </div>
        </div>
    </div>
    
    <!-- Dark Mode Toggle Button (Floating) -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode" data-i18n-aria="consultation.accessibility.toggleDarkMode">
        <div class="theme-toggle-icon">
            <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg class="moon-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </div>
    </button>
    
    <!-- Scripts -->
    <script src="js/database-service.js"></script>
    <script src="js/email-service.js"></script>
    <script src="i18n/i18n-complete.js"></script>
    <script>
        // Calendar State
        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;
        
        // Initialize calendar
        function initializeCalendar() {
            renderCalendar();
            updateSubmitButton();
        }
        
        // Render calendar
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Update month display
            const monthNames = i18n.t('consultation.calendar.months', { returnObjects: true }) || 
                             ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 
                              'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Generate calendar days
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Empty cells for days before month starts (Monday = 0)
            const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < adjustedFirstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            // Days of the month
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset time for accurate comparison
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const currentDay = new Date(year, month, day);
                currentDay.setHours(0, 0, 0, 0);
                
                const isToday = currentDay.getTime() === today.getTime();
                const isPast = currentDay < today;
                const isWeekend = currentDay.getDay() === 0 || currentDay.getDay() === 6;
                
                if (isToday) {
                    dayElement.classList.add('today');
                }
                
                if (isPast || isWeekend) {
                    dayElement.classList.add('unavailable');
                } else {
                    dayElement.classList.add('available');
                    dayElement.onclick = () => selectDate(year, month, day);
                }
                
                if (selectedDate && 
                    selectedDate.getFullYear() === year && 
                    selectedDate.getMonth() === month && 
                    selectedDate.getDate() === day) {
                    dayElement.classList.add('selected');
                }
                
                calendarDays.appendChild(dayElement);
            }
        }
        
        // Navigate calendar
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }
        
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
        
        // Select date
        function selectDate(year, month, day) {
            selectedDate = new Date(year, month, day);
            renderCalendar();
            showTimeSlots();
            updateSelectedDisplay();
        }
        
        // Show time slots
        function showTimeSlots() {
            const timeSlotSection = document.getElementById('timeSlotSection');
            const timeSlotGrid = document.getElementById('timeSlotGrid');
            
            timeSlotSection.style.display = 'block';
            
            // Generate time slots (9:00 - 17:00, 30 min intervals)
            const timeSlots = [];
            for (let hour = 9; hour < 17; hour++) {
                timeSlots.push(`${hour}:00`);
                timeSlots.push(`${hour}:30`);
            }
            
            // Simulate some slots being unavailable
            const unavailableSlots = ['11:30', '14:00', '15:30'];
            
            timeSlotGrid.innerHTML = timeSlots.map(time => {
                const isUnavailable = unavailableSlots.includes(time);
                return `
                    <div class="time-slot ${isUnavailable ? 'unavailable' : ''} ${selectedTime === time ? 'selected' : ''}" 
                         onclick="${!isUnavailable ? `selectTime('${time}')` : ''}">
                        ${time} ${i18n.t('consultation.calendar.oclock')}
                    </div>
                `;
            }).join('');
        }
        
        // Select time
        function selectTime(time) {
            selectedTime = time;
            showTimeSlots();
            updateSelectedDisplay();
            updateSubmitButton();
        }
        
        // Update selected display
        function updateSelectedDisplay() {
            const display = document.getElementById('selectedTimeDisplay');
            const dateTimeSpan = document.getElementById('selectedDateTime');
            
            if (selectedDate && selectedTime) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const dateStr = selectedDate.toLocaleDateString('de-DE', options);
                dateTimeSpan.textContent = `${dateStr} ${i18n.t('consultation.calendar.at')} ${selectedTime} ${i18n.t('consultation.calendar.oclock')}`;
                display.style.display = 'block';
            } else {
                display.style.display = 'none';
            }
        }
        
        // Update submit button
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            const form = document.getElementById('consultationForm');
            
            const isFormValid = form.checkValidity();
            const isDateTimeSelected = selectedDate && selectedTime;
            
            submitBtn.disabled = !(isFormValid && isDateTimeSelected);
        }
        
        // Submit consultation
        async function submitConsultation() {
            const form = document.getElementById('consultationForm');
            const submitBtn = document.getElementById('submitBtn');
            
            if (!form.checkValidity() || !selectedDate || !selectedTime) {
                form.reportValidity();
                return;
            }
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<span class="loading-spinner"></span> ${i18n.t('consultation.submit.loading')}`;
            
            // Collect form data
            const consultationData = {
                userName: document.getElementById('userName').value,
                userEmail: document.getElementById('userEmail').value,
                userPhone: document.getElementById('userPhone').value,
                businessIdea: document.getElementById('businessIdea').value,
                currentStage: document.getElementById('currentStage').value,
                mainChallenge: document.getElementById('mainChallenge').value,
                appointmentDate: selectedDate,
                appointmentTime: selectedTime,
                type: 'initial_consultation',
                status: 'scheduled',
                createdAt: new Date().toISOString()
            };
            
            // Save to database
            try {
                // Initialize database service if needed
                if (!window.databaseService) {
                    window.databaseService = new DatabaseService();
                }
                
                // Save consultation request to master database
                await window.databaseService.create('appointments', consultationData);
                
                // Save/update onboarding data in master database
                const currentSession = JSON.parse(localStorage.getItem('currentSession') || '{}');
                const onboardingData = JSON.parse(localStorage.getItem('onboardingData') || '{}');
                
                await window.databaseService.saveOnboardingData(consultationData.userEmail, {
                    ...onboardingData,
                    name: consultationData.userName,
                    email: consultationData.userEmail,
                    phone: consultationData.userPhone,
                    businessIdea: consultationData.businessIdea,
                    phase: consultationData.currentStage,
                    mainChallenge: consultationData.mainChallenge,
                    hasInitialConsultation: true
                });
                
                // Also save to localStorage for backward compatibility
                localStorage.setItem('onboardingData', JSON.stringify({
                    ...onboardingData,
                    name: consultationData.userName,
                    email: consultationData.userEmail,
                    phone: consultationData.userPhone,
                    businessIdea: consultationData.businessIdea,
                    phase: consultationData.currentStage,
                    mainChallenge: consultationData.mainChallenge,
                    hasInitialConsultation: true
                }));
                
                // Send confirmation email
                await window.emailService.sendAppointmentConfirmation(
                    consultationData.userEmail,
                    {
                        userName: consultationData.userName,
                        date: selectedDate.toLocaleDateString('de-DE'),
                        time: selectedTime,
                        type: i18n.t('consultation.email.appointmentType'),
                        duration: i18n.t('consultation.email.duration'),
                        location: i18n.t('consultation.email.location')
                    }
                );
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.querySelector('.consultation-content').style.display = 'none';
                document.querySelector('.submit-section button').style.display = 'none';
                
                // Scroll to success message
                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
                
                // Auto-login and redirect after 3 seconds
                setTimeout(() => {
                    // Create session
                    localStorage.setItem('currentSession', JSON.stringify({
                        email: consultationData.userEmail,
                        name: consultationData.userName,
                        loginTime: new Date().toISOString()
                    }));
                    
                    // Save consultation data for dashboard
                    localStorage.setItem('initialConsultation', JSON.stringify(consultationData));
                    
                    // Redirect to dashboard
                    window.location.href = 'dashboard.html?welcome=true';
                }, 3000);
                
            } catch (error) {
                console.error('Error booking consultation:', error);
                submitBtn.innerHTML = `<span data-i18n="consultation.submit.button">üöÄ Kostenloses Erstgespr√§ch buchen</span>`;
                submitBtn.disabled = false;
                alert(i18n.t('consultation.submit.error'));
            }
        }
        
        // Form validation
        document.getElementById('consultationForm').addEventListener('input', updateSubmitButton);
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize i18n
            await i18n.init();
            
            // Small delay to ensure form is fully rendered
            setTimeout(async () => {
                initializeCalendar();
                
            
            // Pre-fill form with all available data
            const currentSession = JSON.parse(localStorage.getItem('currentSession') || '{}');
            const landingData = JSON.parse(localStorage.getItem('landingPageData') || '{}');
            let onboardingData = JSON.parse(localStorage.getItem('onboardingData') || '{}');
            
            // Try to get data from master database if available
            if (window.databaseService && currentSession.email) {
                try {
                    const dbResult = await window.databaseService.getOnboardingData(currentSession.email);
                    if (dbResult.success && dbResult.data) {
                        // Merge with local storage data, database takes precedence
                        onboardingData = { ...onboardingData, ...dbResult.data };
                    }
                } catch (error) {
                }
            }
            
            
            // Name - check all possible field names
            const userName = currentSession.name || 
                           onboardingData.name || 
                           onboardingData.userName || 
                           onboardingData.founderName ||
                           landingData.name || 
                           landingData.userName || '';
            
            if (userName) {
                const nameField = document.getElementById('userName');
                if (nameField) {
                    nameField.value = userName;
                }
            }
            
            // Email
            const userEmail = currentSession.email || 
                            onboardingData.email || 
                            landingData.email || '';
            if (userEmail) {
                document.getElementById('userEmail').value = userEmail;
            }
            
            // Phone - check all possible field names and sources
            const userPhone = onboardingData.phone || 
                            onboardingData.phoneNumber ||
                            onboardingData.founderPhone ||
                            landingData.phone || 
                            landingData.phoneNumber || '';
            
            // If we have separate prefix and number, combine them (from onboardingData too!)
            const phonePrefix = onboardingData.phonePrefix || landingData.phonePrefix || '';
            const phoneNumber = onboardingData.phoneNumber || landingData.phoneNumber || '';
            const fullPhone = userPhone || (phonePrefix && phoneNumber ? `${phonePrefix} ${phoneNumber}` : '');
            
            if (fullPhone) {
                const phoneField = document.getElementById('userPhone');
                if (phoneField) {
                    phoneField.value = fullPhone;
                }
            }
            
            // Business Idea - check all possible field names
            const businessIdea = onboardingData.businessIdea || 
                               onboardingData.idea ||
                               onboardingData.ideaDescription ||
                               landingData.businessIdea || 
                               landingData.idea || '';
            if (businessIdea) {
                document.getElementById('businessIdea').value = businessIdea;
            }
            
            // Current Stage - check all possible field names
            const stage = onboardingData.stage || 
                        onboardingData.foundationPhase ||
                        onboardingData.phase ||
                        landingData.stage || 
                        landingData.phase || '';
            if (stage) {
                const stageMapping = {
                    'ideenphase': 'idea',
                    'konzeptphase': 'research',
                    'gruendungsphase': 'prototype',
                    'wachstumsphase': 'early_customers',
                    'idea': 'idea',
                    'concept': 'research',
                    'founding': 'prototype',
                    'growth': 'early_customers'
                };
                const mappedStage = stageMapping[stage] || stage;
                const stageField = document.getElementById('currentStage');
                if (stageField) {
                    stageField.value = mappedStage;
                    
                }
            }
            
            updateSubmitButton();
            
            }, 100); // End of setTimeout
            
        });
        
        // Session Management for Header
        function checkSession() {
            const session = JSON.parse(localStorage.getItem('currentSession') || '{}');
            const sessionInfo = document.getElementById('sessionInfo');
            const userNameDisplay = document.getElementById('userNameDisplay');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (session.email) {
                // User is logged in
                sessionInfo.style.display = 'flex';
                userNameDisplay.textContent = session.name || session.email;
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
            } else {
                // User is not logged in
                sessionInfo.style.display = 'none';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
            }
        }
        
        function logout() {
            localStorage.removeItem('currentSession');
            window.location.href = 'login.html';
        }
        
        // Check session on load
        document.addEventListener('DOMContentLoaded', function() {
            checkSession();
            initTheme();
        });
        
        // Theme Management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }
        
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }
        
        function updateThemeIcon(theme) {
            // Theme icon updates are handled by CSS in theme-toggle-redesign.css
        }
        
        // Add hover effects
        const style = document.createElement('style');
        style.textContent = `
            .nav-link:hover {
                color: #1f2937 !important;
                background: rgba(9, 127, 232, 0.05);
            }
            .btn.btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(9, 127, 232, 0.3);
            }
            #logoutBtn:hover {
                color: #dc2626 !important;
            }
            
            /* Dark mode header support */
            [data-theme="dark"] .header.glass {
                background: rgba(18, 18, 18, 0.95) !important;
                border-bottom: 1px solid rgba(255,255,255,0.1) !important;
            }
            [data-theme="dark"] .logo {
                color: rgba(255, 255, 255, 0.9) !important;
            }
            [data-theme="dark"] .nav-link {
                color: rgba(255, 255, 255, 0.7) !important;
            }
            [data-theme="dark"] .nav-link:hover {
                color: rgba(255, 255, 255, 0.9) !important;
                background: rgba(255, 255, 255, 0.05) !important;
            }
            [data-theme="dark"] #userNameDisplay {
                color: rgba(255, 255, 255, 0.7) !important;
            }
        `;
        document.head.appendChild(style);
    </script>
    
    <!-- üåç UNIFIED I18N SYSTEM - Ersetzt alle 5 verschiedenen i18n-Implementierungen -->
    <script src="js/unified-i18n.js"></script>
</body>
</html>