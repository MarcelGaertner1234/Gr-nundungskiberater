<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kostenloses Erstgespr√§ch - KI Konzept Builder</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="notion-design-system.css">
    <link rel="stylesheet" href="landing-page-design-system.css">
    <link rel="stylesheet" href="loading-states.css">
    <link rel="stylesheet" href="calendar-styles.css">
    <link rel="stylesheet" href="modal-styles.css">
    
    <style>
        body {
            background: linear-gradient(to bottom, #f6f5f4 0%, #fff 100%);
            min-height: 100vh;
            padding-top: 80px;
        }
        
        .consultation-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .consultation-header {
            text-align: center;
            margin-bottom: 60px;
        }
        
        .consultation-header h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1f2937;
            background: linear-gradient(90deg, #097fe8, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .consultation-header p {
            font-size: 20px;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .consultation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        /* Idea Form Section */
        .idea-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        
        .idea-section h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            font-size: 16px;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #097fe8;
            box-shadow: 0 0 0 3px rgba(9, 127, 232, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .form-helper {
            font-size: 14px;
            color: #6b7280;
            margin-top: 6px;
        }
        
        /* Calendar Section */
        .calendar-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        
        .calendar-section h2 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .time-slot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 24px;
        }
        
        .time-slot {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }
        
        .time-slot:hover {
            border-color: #097fe8;
            background: #f0f7ff;
        }
        
        .time-slot.selected {
            border-color: #097fe8;
            background: #097fe8;
            color: white;
        }
        
        .time-slot.unavailable {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        /* Benefits Section */
        .benefits-section {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }
        
        .benefit-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(14, 165, 233, 0.2);
        }
        
        .benefit-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .benefit-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }
        
        .benefit-description {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
        }
        
        /* Submit Section */
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }
        
        .submit-btn {
            background: linear-gradient(90deg, #097fe8, #8b5cf6);
            color: white;
            padding: 16px 48px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(9, 127, 232, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Success Message */
        .success-message {
            display: none;
            background: #f0fdf4;
            border: 1px solid #10b981;
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            text-align: center;
        }
        
        .success-message h3 {
            font-size: 20px;
            font-weight: 600;
            color: #065f46;
            margin-bottom: 8px;
        }
        
        .success-message p {
            color: #047857;
            margin-bottom: 16px;
        }
        
        /* Calendar Widget */
        .calendar-widget {
            background: #f9fafb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-month {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
        }
        
        .calendar-nav button {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-nav button:hover {
            background: #f3f4f6;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-days:first-of-type {
            margin-bottom: 12px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            padding: 8px 0;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .calendar-day.available {
            background: white;
            border: 1px solid #e5e7eb;
        }
        
        .calendar-day.available:hover {
            background: #f0f7ff;
            border-color: #097fe8;
        }
        
        .calendar-day.selected {
            background: #097fe8;
            color: white;
            border-color: #097fe8;
        }
        
        .calendar-day.unavailable {
            color: #d1d5db;
            cursor: not-allowed;
        }
        
        .calendar-day.today {
            border: 2px solid #097fe8;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .consultation-content {
                grid-template-columns: 1fr;
            }
            
            .consultation-header h1 {
                font-size: 36px;
            }
            
            .benefits-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header glass">
        <div class="container">
            <div class="header-content">
                <div class="header-logo">
                    <a href="landing-page.html" class="logo">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                        </svg>
                        KI Konzept Builder
                    </a>
                </div>
                <div class="header-nav">
                    <a href="dashboard.html" class="nav-link">Dashboard</a>
                    <a href="login.html" class="btn btn-primary">Anmelden</a>
                </div>
            </div>
        </div>
    </header>

    <div class="consultation-container">
        <!-- Header Section -->
        <div class="consultation-header">
            <h1>Kostenloses Erstgespr√§ch buchen</h1>
            <p>Erz√§hle uns von deiner Gesch√§ftsidee und sichere dir eine kostenlose 30-min√ºtige Beratung mit unseren Gr√ºndungsexperten</p>
        </div>
        
        <!-- Benefits Section -->
        <div class="benefits-section">
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">üéØ</div>
                    <div class="benefit-title">Ma√ügeschneiderte Beratung</div>
                    <div class="benefit-description">Wir bereiten uns auf deine Idee vor und geben dir konkrete Tipps</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">üí∞</div>
                    <div class="benefit-title">100% Kostenlos</div>
                    <div class="benefit-description">Keine versteckten Kosten, keine Verpflichtungen</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">üöÄ</div>
                    <div class="benefit-title">Schnellstart-Plan</div>
                    <div class="benefit-description">Erhalte einen konkreten Fahrplan f√ºr deine Gr√ºndung</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">üèÜ</div>
                    <div class="benefit-title">Erfahrene Experten</div>
                    <div class="benefit-description">Unsere Berater haben √ºber 100+ Gr√ºndungen begleitet</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="consultation-content">
            <!-- Idea Form Section -->
            <div class="idea-section">
                <h2>üí° Deine Gesch√§ftsidee</h2>
                
                <form id="consultationForm">
                    <div class="form-group">
                        <label class="form-label" for="userName">Dein Name *</label>
                        <input type="text" id="userName" class="form-input" required placeholder="Max Mustermann">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userEmail">E-Mail-Adresse *</label>
                        <input type="email" id="userEmail" class="form-input" required placeholder="max@beispiel.de">
                        <p class="form-helper">Wir senden dir hier die Terminbest√§tigung</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userPhone">Telefonnummer (optional)</label>
                        <input type="tel" id="userPhone" class="form-input" placeholder="+49 123 456789">
                        <p class="form-helper">F√ºr kurzfristige Termin√§nderungen</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="businessIdea">Beschreibe deine Gesch√§ftsidee *</label>
                        <textarea id="businessIdea" class="form-textarea" required placeholder="Ich m√∂chte ein Online-Marktplatz f√ºr..."></textarea>
                        <p class="form-helper">Je detaillierter, desto besser k√∂nnen wir uns vorbereiten</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="currentStage">In welcher Phase befindest du dich? *</label>
                        <select id="currentStage" class="form-input" required>
                            <option value="">Bitte w√§hlen...</option>
                            <option value="idea">Nur eine Idee</option>
                            <option value="research">Marktforschung</option>
                            <option value="prototype">Prototyp/MVP vorhanden</option>
                            <option value="early_customers">Erste Kunden</option>
                            <option value="scaling">Skalierung geplant</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="mainChallenge">Was ist deine gr√∂√üte Herausforderung?</label>
                        <textarea id="mainChallenge" class="form-textarea" placeholder="Ich brauche Hilfe bei der Finanzierung..."></textarea>
                    </div>
                </form>
            </div>
            
            <!-- Calendar Section -->
            <div class="calendar-section">
                <h2>üìÖ W√§hle deinen Wunschtermin</h2>
                
                <!-- Calendar Widget -->
                <div class="calendar-widget">
                    <div class="calendar-header">
                        <span class="calendar-month" id="calendarMonth">Januar 2025</span>
                        <div class="calendar-nav">
                            <button onclick="previousMonth()">‚Üê</button>
                            <button onclick="nextMonth()">‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="calendar-days">
                        <div class="calendar-day-header">Mo</div>
                        <div class="calendar-day-header">Di</div>
                        <div class="calendar-day-header">Mi</div>
                        <div class="calendar-day-header">Do</div>
                        <div class="calendar-day-header">Fr</div>
                        <div class="calendar-day-header">Sa</div>
                        <div class="calendar-day-header">So</div>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                        <!-- Calendar days will be populated here -->
                    </div>
                </div>
                
                <!-- Time Slots -->
                <div id="timeSlotSection" style="display: none;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Verf√ºgbare Zeiten</h3>
                    <div class="time-slot-grid" id="timeSlotGrid">
                        <!-- Time slots will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Selected Time Display -->
                <div id="selectedTimeDisplay" style="display: none; margin-top: 24px; padding: 16px; background: #f0f7ff; border-radius: 8px;">
                    <p style="font-weight: 500; color: #1f2937;">
                        <span style="color: #097fe8;">‚úì</span> Ausgew√§hlter Termin: 
                        <span id="selectedDateTime" style="font-weight: 600;"></span>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Submit Section -->
        <div class="submit-section">
            <button class="submit-btn" id="submitBtn" onclick="submitConsultation()" disabled>
                üöÄ Kostenloses Erstgespr√§ch buchen
            </button>
            
            <div class="success-message" id="successMessage">
                <h3>üéâ Termin erfolgreich gebucht!</h3>
                <p>Wir haben dir eine Best√§tigungs-E-Mail gesendet. Wir freuen uns auf unser Gespr√§ch!</p>
                <a href="dashboard.html" class="btn btn-primary">Zum Dashboard</a>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/database-service.js"></script>
    <script src="js/email-service.js"></script>
    <script src="i18n/i18n-complete.js"></script>
    <script>
        // Calendar State
        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;
        
        // Initialize calendar
        function initializeCalendar() {
            renderCalendar();
            updateSubmitButton();
        }
        
        // Render calendar
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Update month display
            const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 
                               'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Generate calendar days
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Empty cells for days before month starts (Monday = 0)
            const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < adjustedFirstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            // Days of the month
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset time for accurate comparison
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const currentDay = new Date(year, month, day);
                currentDay.setHours(0, 0, 0, 0);
                
                const isToday = currentDay.getTime() === today.getTime();
                const isPast = currentDay < today;
                const isWeekend = currentDay.getDay() === 0 || currentDay.getDay() === 6;
                
                if (isToday) {
                    dayElement.classList.add('today');
                }
                
                if (isPast || isWeekend) {
                    dayElement.classList.add('unavailable');
                } else {
                    dayElement.classList.add('available');
                    dayElement.onclick = () => selectDate(year, month, day);
                }
                
                if (selectedDate && 
                    selectedDate.getFullYear() === year && 
                    selectedDate.getMonth() === month && 
                    selectedDate.getDate() === day) {
                    dayElement.classList.add('selected');
                }
                
                calendarDays.appendChild(dayElement);
            }
        }
        
        // Navigate calendar
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }
        
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
        
        // Select date
        function selectDate(year, month, day) {
            selectedDate = new Date(year, month, day);
            renderCalendar();
            showTimeSlots();
            updateSelectedDisplay();
        }
        
        // Show time slots
        function showTimeSlots() {
            const timeSlotSection = document.getElementById('timeSlotSection');
            const timeSlotGrid = document.getElementById('timeSlotGrid');
            
            timeSlotSection.style.display = 'block';
            
            // Generate time slots (9:00 - 17:00, 30 min intervals)
            const timeSlots = [];
            for (let hour = 9; hour < 17; hour++) {
                timeSlots.push(`${hour}:00`);
                timeSlots.push(`${hour}:30`);
            }
            
            // Simulate some slots being unavailable
            const unavailableSlots = ['11:30', '14:00', '15:30'];
            
            timeSlotGrid.innerHTML = timeSlots.map(time => {
                const isUnavailable = unavailableSlots.includes(time);
                return `
                    <div class="time-slot ${isUnavailable ? 'unavailable' : ''} ${selectedTime === time ? 'selected' : ''}" 
                         onclick="${!isUnavailable ? `selectTime('${time}')` : ''}">
                        ${time} Uhr
                    </div>
                `;
            }).join('');
        }
        
        // Select time
        function selectTime(time) {
            selectedTime = time;
            showTimeSlots();
            updateSelectedDisplay();
            updateSubmitButton();
        }
        
        // Update selected display
        function updateSelectedDisplay() {
            const display = document.getElementById('selectedTimeDisplay');
            const dateTimeSpan = document.getElementById('selectedDateTime');
            
            if (selectedDate && selectedTime) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const dateStr = selectedDate.toLocaleDateString('de-DE', options);
                dateTimeSpan.textContent = `${dateStr} um ${selectedTime} Uhr`;
                display.style.display = 'block';
            } else {
                display.style.display = 'none';
            }
        }
        
        // Update submit button
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            const form = document.getElementById('consultationForm');
            
            const isFormValid = form.checkValidity();
            const isDateTimeSelected = selectedDate && selectedTime;
            
            submitBtn.disabled = !(isFormValid && isDateTimeSelected);
        }
        
        // Submit consultation
        async function submitConsultation() {
            const form = document.getElementById('consultationForm');
            const submitBtn = document.getElementById('submitBtn');
            
            if (!form.checkValidity() || !selectedDate || !selectedTime) {
                form.reportValidity();
                return;
            }
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Wird gebucht...';
            
            // Collect form data
            const consultationData = {
                userName: document.getElementById('userName').value,
                userEmail: document.getElementById('userEmail').value,
                userPhone: document.getElementById('userPhone').value,
                businessIdea: document.getElementById('businessIdea').value,
                currentStage: document.getElementById('currentStage').value,
                mainChallenge: document.getElementById('mainChallenge').value,
                appointmentDate: selectedDate,
                appointmentTime: selectedTime,
                type: 'initial_consultation',
                status: 'scheduled',
                createdAt: new Date().toISOString()
            };
            
            // Save to database
            try {
                // Initialize database service if needed
                if (!window.databaseService) {
                    window.databaseService = new DatabaseService();
                }
                
                // Save consultation request to master database
                await window.databaseService.create('appointments', consultationData);
                
                // Save/update onboarding data in master database
                const currentSession = JSON.parse(localStorage.getItem('currentSession') || '{}');
                const onboardingData = JSON.parse(localStorage.getItem('onboardingData') || '{}');
                
                await window.databaseService.saveOnboardingData(consultationData.userEmail, {
                    ...onboardingData,
                    name: consultationData.userName,
                    email: consultationData.userEmail,
                    phone: consultationData.userPhone,
                    businessIdea: consultationData.businessIdea,
                    phase: consultationData.currentStage,
                    mainChallenge: consultationData.mainChallenge,
                    hasInitialConsultation: true
                });
                
                // Also save to localStorage for backward compatibility
                localStorage.setItem('onboardingData', JSON.stringify({
                    ...onboardingData,
                    name: consultationData.userName,
                    email: consultationData.userEmail,
                    phone: consultationData.userPhone,
                    businessIdea: consultationData.businessIdea,
                    phase: consultationData.currentStage,
                    mainChallenge: consultationData.mainChallenge,
                    hasInitialConsultation: true
                }));
                
                // Send confirmation email
                await window.EmailService.sendAppointmentConfirmation(
                    consultationData.userEmail,
                    {
                        userName: consultationData.userName,
                        date: selectedDate.toLocaleDateString('de-DE'),
                        time: selectedTime,
                        type: 'Kostenloses Erstgespr√§ch',
                        duration: '30 Minuten',
                        location: 'Video-Call (Link folgt per E-Mail)'
                    }
                );
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.querySelector('.consultation-content').style.display = 'none';
                document.querySelector('.submit-section button').style.display = 'none';
                
                // Scroll to success message
                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
                
                // Auto-login and redirect after 3 seconds
                setTimeout(() => {
                    // Create session
                    localStorage.setItem('currentSession', JSON.stringify({
                        email: consultationData.userEmail,
                        name: consultationData.userName,
                        loginTime: new Date().toISOString()
                    }));
                    
                    // Save consultation data for dashboard
                    localStorage.setItem('initialConsultation', JSON.stringify(consultationData));
                    
                    // Redirect to dashboard
                    window.location.href = 'dashboard.html?welcome=true';
                }, 3000);
                
            } catch (error) {
                console.error('Error booking consultation:', error);
                submitBtn.innerHTML = 'üöÄ Kostenloses Erstgespr√§ch buchen';
                submitBtn.disabled = false;
                alert('Es gab einen Fehler bei der Buchung. Bitte versuche es erneut.');
            }
        }
        
        // Form validation
        document.getElementById('consultationForm').addEventListener('input', updateSubmitButton);
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, initializing...');
            
            // Small delay to ensure form is fully rendered
            setTimeout(async () => {
                initializeCalendar();
                
                // Debug - log all available data
                console.log('Loading form data...');
            
            // Pre-fill form with all available data
            const currentSession = JSON.parse(localStorage.getItem('currentSession') || '{}');
            const landingData = JSON.parse(localStorage.getItem('landingPageData') || '{}');
            let onboardingData = JSON.parse(localStorage.getItem('onboardingData') || '{}');
            
            // Try to get data from master database if available
            if (window.databaseService && currentSession.email) {
                try {
                    const dbResult = await window.databaseService.getOnboardingData(currentSession.email);
                    if (dbResult.success && dbResult.data) {
                        console.log('Found onboarding data in database:', dbResult.data);
                        // Merge with local storage data, database takes precedence
                        onboardingData = { ...onboardingData, ...dbResult.data };
                    }
                } catch (error) {
                    console.log('Database not available, using localStorage only');
                }
            }
            
            // The landing page saves data under 'onboardingData' key!
            // So onboardingData contains the form data from landing page
            console.log('Current Session:', currentSession);
            console.log('Landing Data:', landingData);
            console.log('Onboarding Data:', onboardingData);
            
            // Name - check all possible field names
            const userName = currentSession.name || 
                           onboardingData.name || 
                           onboardingData.userName || 
                           onboardingData.founderName ||
                           landingData.name || 
                           landingData.userName || '';
            
            console.log('Name debug:', {
                userName,
                sessionName: currentSession.name,
                onboardingName: onboardingData.name,
                onboardingUserName: onboardingData.userName,
                landingName: landingData.name
            });
            
            console.log('Found name:', userName);
            if (userName) {
                const nameField = document.getElementById('userName');
                console.log('Name field element:', nameField);
                if (nameField) {
                    nameField.value = userName;
                    console.log('Name field value set to:', nameField.value);
                } else {
                    console.error('Name field not found!');
                }
            }
            
            // Email
            const userEmail = currentSession.email || 
                            onboardingData.email || 
                            landingData.email || '';
            
            console.log('Found email:', userEmail);
            if (userEmail) {
                document.getElementById('userEmail').value = userEmail;
            }
            
            // Phone - check all possible field names and sources
            const userPhone = onboardingData.phone || 
                            onboardingData.phoneNumber ||
                            onboardingData.founderPhone ||
                            landingData.phone || 
                            landingData.phoneNumber || '';
            
            // If we have separate prefix and number, combine them (from onboardingData too!)
            const phonePrefix = onboardingData.phonePrefix || landingData.phonePrefix || '';
            const phoneNumber = onboardingData.phoneNumber || landingData.phoneNumber || '';
            const fullPhone = userPhone || (phonePrefix && phoneNumber ? `${phonePrefix} ${phoneNumber}` : '');
            
            console.log('Phone debug:', {
                userPhone,
                phonePrefix,
                phoneNumber,
                fullPhone,
                onboardingDataPhone: onboardingData.phone,
                onboardingDataPhoneNumber: onboardingData.phoneNumber
            });
            
            console.log('Found phone:', fullPhone);
            if (fullPhone) {
                const phoneField = document.getElementById('userPhone');
                console.log('Phone field element:', phoneField);
                if (phoneField) {
                    phoneField.value = fullPhone;
                    console.log('Phone field value set to:', phoneField.value);
                } else {
                    console.error('Phone field not found!');
                }
            }
            
            // Business Idea - check all possible field names
            const businessIdea = onboardingData.businessIdea || 
                               onboardingData.idea ||
                               onboardingData.ideaDescription ||
                               landingData.businessIdea || 
                               landingData.idea || '';
            
            console.log('Found business idea:', businessIdea);
            if (businessIdea) {
                document.getElementById('businessIdea').value = businessIdea;
            }
            
            // Current Stage - check all possible field names
            const stage = onboardingData.stage || 
                        onboardingData.foundationPhase ||
                        onboardingData.phase ||
                        landingData.stage || 
                        landingData.phase || '';
            
            console.log('Found stage:', stage);
            if (stage) {
                const stageMapping = {
                    'ideenphase': 'idea',
                    'konzeptphase': 'research',
                    'gruendungsphase': 'prototype',
                    'wachstumsphase': 'early_customers',
                    'idea': 'idea',
                    'concept': 'research',
                    'founding': 'prototype',
                    'growth': 'early_customers'
                };
                const mappedStage = stageMapping[stage] || stage;
                console.log('Mapped stage to:', mappedStage);
                const stageField = document.getElementById('currentStage');
                console.log('Stage field element:', stageField);
                if (stageField) {
                    stageField.value = mappedStage;
                    console.log('Stage field value set to:', stageField.value);
                    
                    // Check if the value exists in the select options
                    const optionExists = Array.from(stageField.options).some(option => option.value === mappedStage);
                    if (!optionExists) {
                        console.error('Stage value not found in select options:', mappedStage);
                        console.log('Available options:', Array.from(stageField.options).map(o => o.value));
                    }
                } else {
                    console.error('Stage field not found!');
                }
            }
            
            updateSubmitButton();
            
            }, 100); // End of setTimeout
            
            // Development helper - simulate data from landing page
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname === '') {
                const testButton = document.createElement('button');
                testButton.textContent = 'Test: Lade Beispieldaten';
                testButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 9999; background: #ff4444; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;';
                testButton.onclick = function() {
                    // Simulate landing page data (as it's saved by the landing page)
                    const testData = {
                        name: 'Max Mustermann',
                        email: 'max@beispiel.de',
                        country: 'DE',
                        phone: '+49 123 456789',
                        phonePrefix: '+49',
                        phoneNumber: '123 456789',
                        businessIdea: 'Ich m√∂chte einen Online-Marktplatz f√ºr nachhaltige Produkte aufbauen',
                        phase: 'ideenphase',
                        profile: 'founder',
                        timeline: 'sofort',
                        consultingPreference: 'erstgespraech'
                    };
                    localStorage.setItem('onboardingData', JSON.stringify(testData));
                    alert('Testdaten geladen! Seite wird neu geladen...');
                    window.location.reload();
                };
                document.body.appendChild(testButton);
                
                // Add debug button to check localStorage
                const debugButton = document.createElement('button');
                debugButton.textContent = 'Debug: Zeige LocalStorage';
                debugButton.style.cssText = 'position: fixed; bottom: 20px; left: 20px; z-index: 9999; background: #4444ff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;';
                debugButton.onclick = function() {
                    console.log('=== LocalStorage Debug ===');
                    console.log('onboardingData:', localStorage.getItem('onboardingData'));
                    console.log('currentSession:', localStorage.getItem('currentSession'));
                    console.log('landingPageData:', localStorage.getItem('landingPageData'));
                    alert('Schaue in die Browser-Konsole f√ºr LocalStorage Daten');
                };
                document.body.appendChild(debugButton);
            }
        });
    </script>
</body>
</html>