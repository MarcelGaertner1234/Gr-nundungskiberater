<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="forgot_password.title">Passwort zurücksetzen - KI Konzept Builder</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23646cff'><circle cx='12' cy='12' r='12'/></svg>">
    <meta name="description" content="Setze dein Passwort für den KI Konzept Builder zurück" data-i18n-content="forgot_password.meta_description">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- CSS -->
    <link rel="stylesheet" href="notion-design-system.css">
    <link rel="stylesheet" href="loading-states.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #f6f5f4 0%, #fff 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .reset-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .reset-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.1),
                0 10px 40px rgba(0, 0, 0, 0.06);
            border: 1px solid #e1e5e9;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: #37352f;
            font-weight: 600;
            font-size: 18px;
        }

        .logo svg {
            width: 32px;
            height: 32px;
            color: #646cff;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 8px;
            text-align: center;
        }

        .subtitle {
            font-size: 14px;
            color: #64645f;
            text-align: center;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #37352f;
            margin-bottom: 6px;
        }

        .form-input,
        .code-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            color: #37352f;
            background: white;
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .code-input:focus {
            outline: none;
            border-color: #646cff;
            box-shadow: 0 0 0 3px rgba(100, 108, 255, 0.1);
        }

        .code-inputs {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .code-input {
            width: 48px;
            height: 56px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
        }

        .button-primary {
            width: 100%;
            padding: 14px 24px;
            background: #646cff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }

        .button-primary:hover {
            background: #5856eb;
            transform: translateY(-1px);
        }

        .button-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .back-link {
            text-align: center;
        }

        .back-link a {
            color: #646cff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
        }

        .info-message {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #2563eb;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
        }

        .reset-code-section {
            display: none;
        }

        /* Dark mode */
        [data-theme="dark"] {
            background: linear-gradient(to bottom, #1f1f23 0%, #16161a 100%);
        }

        [data-theme="dark"] .reset-card {
            background: #1e1e1e;
            border-color: #333;
        }

        [data-theme="dark"] .title {
            color: #f9f9f9;
        }

        [data-theme="dark"] .subtitle {
            color: #a1a1aa;
        }

        [data-theme="dark"] .form-label {
            color: #d4d4d8;
        }

        [data-theme="dark"] .form-input,
        [data-theme="dark"] .code-input {
            background: #27272a;
            border-color: #3f3f46;
            color: #f9f9f9;
        }

        [data-theme="dark"] .form-input:focus,
        [data-theme="dark"] .code-input:focus {
            border-color: #646cff;
            box-shadow: 0 0 0 3px rgba(100, 108, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="reset-container">
        <div class="reset-card">
            <div class="logo-section">
                <a href="landing-page.html" class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    KI Konzept Builder
                </a>
            </div>

            <!-- E-Mail Section -->
            <div id="emailSection">
                <h1 class="title" data-i18n="auth.reset.title">Passwort zurücksetzen</h1>
                <p class="subtitle" data-i18n="auth.reset.subtitle">Gib deine E-Mail-Adresse ein und wir senden dir einen Code zum Zurücksetzen deines Passworts.</p>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>
                <div class="info-message" id="infoMessage"></div>

                <form id="resetForm" onsubmit="handleResetRequest(event)">
                    <div class="form-group">
                        <label class="form-label" for="email" data-i18n="auth.form.email_label">E-Mail Adresse</label>
                        <input 
                            type="email"
                            id="email"
                            name="email"
                            class="form-input"
                            data-i18n-placeholder="auth.form.email_placeholder"
                            placeholder="deine@email.de"
                            required
                        >
                    </div>
                    <button type="submit" class="button-primary" id="submitButton">
                        <span data-i18n="auth.reset.send_code">Code senden</span>
                    </button>
                </form>
            </div>

            <!-- Code Section -->
            <div id="codeSection" class="reset-code-section">
                <h1 class="title" data-i18n="auth.reset.verify_title">Code eingeben</h1>
                <p class="subtitle" data-i18n="auth.reset.verify_subtitle">Wir haben einen 6-stelligen Code an deine E-Mail gesendet.</p>

                <div class="error-message" id="codeErrorMessage"></div>

                <form id="codeForm" onsubmit="handleCodeVerification(event)">
                    <div class="code-inputs">
                        <input type="text" class="code-input" maxlength="1" oninput="handleCodeInput(this, 0)">
                        <input type="text" class="code-input" maxlength="1" oninput="handleCodeInput(this, 1)">
                        <input type="text" class="code-input" maxlength="1" oninput="handleCodeInput(this, 2)">
                        <input type="text" class="code-input" maxlength="1" oninput="handleCodeInput(this, 3)">
                        <input type="text" class="code-input" maxlength="1" oninput="handleCodeInput(this, 4)">
                        <input type="text" class="code-input" maxlength="1" oninput="handleCodeInput(this, 5)">
                    </div>
                    <button type="submit" class="button-primary" id="verifyButton">
                        <span data-i18n="auth.reset.verify_code">Code überprüfen</span>
                    </button>
                </form>

                <div class="back-link">
                    <a href="#" onclick="showEmailSection()" data-i18n="auth.reset.resend_code">Neuen Code senden</a>
                </div>
            </div>

            <!-- Password Section -->
            <div id="passwordSection" class="reset-code-section">
                <h1 class="title" data-i18n="auth.reset.new_password_title">Neues Passwort festlegen</h1>
                <p class="subtitle" data-i18n="auth.reset.new_password_subtitle">Wähle ein sicheres Passwort für dein Konto.</p>

                <div class="error-message" id="passwordErrorMessage"></div>

                <form id="passwordForm" onsubmit="handlePasswordReset(event)">
                    <div class="form-group">
                        <label class="form-label" for="newPassword" data-i18n="auth.reset.new_password_label">Neues Passwort</label>
                        <input 
                            type="password"
                            id="newPassword"
                            name="newPassword"
                            class="form-input"
                            data-i18n-placeholder="auth.reset.new_password_placeholder"
                            placeholder="Mindestens 8 Zeichen"
                            required
                            minlength="8"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="confirmPassword" data-i18n="auth.reset.confirm_password_label">Passwort bestätigen</label>
                        <input 
                            type="password"
                            id="confirmPassword"
                            name="confirmPassword"
                            class="form-input"
                            data-i18n-placeholder="auth.reset.confirm_password_placeholder"
                            placeholder="Passwort wiederholen"
                            required
                            minlength="8"
                        >
                    </div>
                    <button type="submit" class="button-primary" id="resetButton">
                        <span data-i18n="auth.reset.reset_password">Passwort zurücksetzen</span>
                    </button>
                </form>

                <div class="back-link">
                    <span data-i18n="auth.reset.back_to">Zurück zur</span> <a href="login.html" data-i18n="auth.reset.login_link">Anmeldung</a>
                </div>
            </div>
        </div>
    </div>

    <!-- i18n Scripts -->
    <script src="i18n/i18n-complete.js"></script>
    <script>
        // Demo users for testing
        const DEMO_USERS = [
            {
                email: 'demo@test.de',
                provider: 'email',
                password: 'demo123'
            },
            {
                email: 'google@test.de',
                provider: 'Google',
                password: null
            }
        ];

        let resetEmail = '';
        let resetCode = '';
        let codeExpiry = null;

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function showInfo(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function handleResetRequest(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const user = DEMO_USERS.find(u => u.email === email);

            // Check if user exists
            if (!user) {
                showError('errorMessage', i18nManager.t('forgot_password.errors.no_account'));
                return;
            }

            // Check if it's an OAuth account
            if (user.provider !== 'email') {
                showError('errorMessage', i18nManager.t('forgot_password.errors.oauth_account', { provider: user.provider }));
                return;
            }

            resetEmail = email;
            resetCode = Math.floor(100000 + Math.random() * 900000).toString();
            codeExpiry = Date.now() + 10 * 60 * 1000; // 10 minutes

            // In demo mode, show the code
            showInfo('infoMessage', i18nManager.t('forgot_password.info.demo_code', { code: resetCode }));

            // In real app, you would send the code via email
            showSuccess('successMessage', i18nManager.t('forgot_password.success.code_sent'));

            setTimeout(showCodeSection, 2000);
        }

        function showCodeSection() {
            document.getElementById('emailSection').style.display = 'none';
            document.getElementById('codeSection').style.display = 'block';
        }

        function showEmailSection() {
            document.getElementById('codeSection').style.display = 'none';
            document.getElementById('emailSection').style.display = 'block';
        }

        function handleCodeInput(input, index) {
            if (input.value.length === 1) {
                const nextInput = input.parentElement.children[index + 1];
                if (nextInput) {
                    nextInput.focus();
                }
            }
        }

        function handleCodeVerification(event) {
            event.preventDefault();
            
            const codeInputs = document.querySelectorAll('.code-input');
            const enteredCode = Array.from(codeInputs).map(input => input.value).join('');

            if (enteredCode.length !== 6) {
                showError('codeErrorMessage', i18nManager.t('forgot_password.errors.code_required'));
                return;
            }

            if (Date.now() > codeExpiry) {
                showError('codeErrorMessage', i18nManager.t('forgot_password.errors.code_expired'));
                return;
            }

            if (enteredCode !== resetCode) {
                showError('codeErrorMessage', i18nManager.t('forgot_password.errors.invalid_code'));
                return;
            }

            showPasswordSection();
        }

        function showPasswordSection() {
            document.getElementById('codeSection').style.display = 'none';
            document.getElementById('passwordSection').style.display = 'block';
        }

        function handlePasswordReset(event) {
            event.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                showError('passwordErrorMessage', i18nManager.t('forgot_password.errors.passwords_no_match'));
                return;
            }

            if (newPassword.length < 8) {
                showError('passwordErrorMessage', i18nManager.t('forgot_password.errors.password_too_short'));
                return;
            }

            // Update user password in demo
            const user = DEMO_USERS.find(u => u.email === resetEmail);
            if (user) {
                user.password = newPassword;
            }

            showSuccess('passwordErrorMessage', i18nManager.t('forgot_password.success.password_reset'));

            setTimeout(() => {
                window.location.href = 'login.html';
            }, 3000);
        }

        // Initialize i18n when page loads
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof i18nManager !== 'undefined') {
                i18nManager.initialize();
            }
        });

        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.target.classList.contains('code-input')) {
                if (e.key === 'Backspace' && e.target.value === '') {
                    const prevInput = e.target.previousElementSibling;
                    if (prevInput && prevInput.classList.contains('code-input')) {
                        prevInput.focus();
                        prevInput.value = '';
                    }
                }
            }
        });
    </script>
</body>
</html>